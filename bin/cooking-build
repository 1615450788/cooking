#!/usr/bin/env node

var webpack = require('webpack');
var utils = require('./../src/utils');
var CONTACTS = require('./../src/contacts');
var ProgressPlugin = require('./../src/libs/ProgressPlugin');

module.exports = function(options) {
  var compiler, use, baseConfig, config;

  CONTACTS.FILE = options.config || CONTACTS.FILE;
  use = utils.fetchUse();
  baseConfig = utils.loadWebpackConfig(CONTACTS.PROD, use);
  config = utils.mergeConfig(baseConfig);

  if (!config) {
    return;
  }

  config.plugins.push(new ProgressPlugin());

  webpack(config, function(err, stats) {
    if (err) {
      return console.log(err);
    }

    console.log(stats.toString({ colors: true, chunks: false }));
  });
};
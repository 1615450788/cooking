#!/usr/bin/env node

var webpack = require('webpack');
var utils = require('./../src/utils');
var CONTACTS = require('./../src/contacts');
var ProgressPlugin = require('./../src/libs/ProgressPlugin');

module.exports = function() {
  var compiler;
  var use = utils.fetchUse();
  var baseConfig = utils.loadWebpackConfig(CONTACTS.PROD, use);
  var config = utils.mergeConfig(baseConfig);

  if (!config) {
    return;
  }

  config.plugins.push(new ProgressPlugin());

  webpack(config, function(err, stats) {
    if (err) {
      return console.log(err);
    }

    console.log(stats.toString({ colors: true, chunks: false }));
  });
};